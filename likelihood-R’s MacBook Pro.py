import numpy as npimport pandas as pdimport mathfrom Q_matrix import Q_matrixfrom Ematrix import E_matrixfrom P_matrix import P_matrixfrom mat import matfrom L_i import L_ifrom functools import reducep = [-3,-4,-4,-5,  1.1,0,1.2,1.4,  2,3,4,5, -.01,.005,.005,.002]no_qpars = 16functions = ['gompertz','gompertz','gompertz','gompertz']age_like='age'death_states = [3]censored_state = [-1,-2]corresponding_censored_states = [[1,2],[1,2,3]]Qm = np.array([[0,.1,0.1],      [0.1,0,.1],      [0,0,0]])covariates_name = ["age","x",'y']j=0d = {'id':[1,1,1,2,2,2,3,3,3,4,4,4]   ,'age': [2,2.2,2.4, 3,3.2,3.4, 4,4.2,4.4, 2,2.2,2.5], 'x': [.1,.1,.1 ,  -.3,-.3,-.3,  -.4,-.4,-.4,   .1,.1,.1],'y': [1,1,1, 2,2,2, 3,3,3, 1,1,1],     'state':[1,2,3, 2,2,3, -1,1,2, 1,-1,2 ]  }dt = pd.DataFrame(data=d)Q_matrix(p,no_qpars,Qm,covariates_name,0,dt,functions,age_like)Use_misclass_matrix=Trueuse_given_initial_prob=Falsep_e=[-1.5, -2.0,  0.3 , 0.2,  0.4,  0.5]no_epars=6E_covariates_name=["age","x"]ematrix = np.array([[0,0.1,0],           [0.1,0,0],           [0,0,0]]           )dt_q=dt.groupby(covariates_name).size().reset_index(name='counts')qlength = len(dt_q.index)dt_q['row'] = np.arange(dt_q.shape[0])Q_list = [Q_matrix(p,no_qpars,Qm,covariates_name,j,dt_q,functions,age_like) for j in range(0, qlength )]dta_s = pd.merge(dt,dt_q,how = 'left')dta_s=dta_s.sort_values(by=['id','age'])dt_E=dt.groupby(E_covariates_name).size().reset_index(name='counts')dt_E['row_E'] = np.arange(dt_E.shape[0])e_length = len(dt_E.index)E_list=[E_matrix(p_e,no_epars,ematrix,j,dt_E,E_covariates_name) for j in range(0, e_length)]dta_s = pd.merge(dta_s,dt_E,how = 'left')dta_s=dta_s.sort_values(by=['id','age'])dta_p=dta_sdta_p['lead_time']=dta_s.groupby(['id'])['age'].shift(-1)dta_p['interval']=dta_p['lead_time']-dta_p['age']dta_p=dta_p.fillna(0)dt_p=dta_p.groupby(['row','interval']).size().reset_index(name='counts')dt_p['row_p'] = np.arange(dt_p.shape[0])plength = len(dt_p.index)dta_p=dta_p.drop(columns=['counts'])dta_p = pd.merge(dta_p,dt_p,how = 'left')dta_p=dta_p.sort_values(by=['id','age'])P_list=[P_matrix(Q_list,dt_p,j) for j in range(0,plength)]L_i(dta_p=dta_p,i=1,Q_list=Q_list,P_list=P_list,death_states=death_states,censored_state=censored_state    ,corresponding_censored_states=corresponding_censored_states,    E_list=E_list,E_covariates_name=E_covariates_name,no_epars=no_epars,    ematrix=ematrix,use_given_initial_prob=use_given_initial_prob,p_e=p_e,    Use_misclass_matrix=Use_misclass_matrix)